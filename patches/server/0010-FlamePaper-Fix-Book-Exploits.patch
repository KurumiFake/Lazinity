From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: linsaftw <linsaftw@users.noreply.github.com>
Date: Sun, 25 Apr 2021 11:53:18 -0300
Subject: [PATCH] (FlamePaper) Fix Book Exploits

Original code by 2lstudios-mc, licensed under MIT
You can find the original code on https://github.com/2lstudios-mc/FlamePaper

diff --git a/src/main/java/net/minecraft/network/PacketDataSerializer.java b/src/main/java/net/minecraft/network/PacketDataSerializer.java
index 579eb1260c7266cd41025cff177de4fb00ac0cec..7f2bb14b8a19a499589cb666b0e307f7e3380ed4 100644
--- a/src/main/java/net/minecraft/network/PacketDataSerializer.java
+++ b/src/main/java/net/minecraft/network/PacketDataSerializer.java
@@ -274,7 +274,7 @@ public class PacketDataSerializer extends ByteBuf {
 
     @Nullable
     public NBTTagCompound l() {
-        return this.a(new NBTReadLimiter(2097152L));
+        return this.a(new NBTReadLimiter(64000L)); // FlamePaper - Reduce NBT read limit
     }
 
     @Nullable
diff --git a/src/main/java/net/minecraft/server/network/LoginListener.java b/src/main/java/net/minecraft/server/network/LoginListener.java
index be80dd0caf06a155d9f58541828543666cd0c16b..d122563022ee1f192231d6e5a250ba4fa551f74e 100644
--- a/src/main/java/net/minecraft/server/network/LoginListener.java
+++ b/src/main/java/net/minecraft/server/network/LoginListener.java
@@ -199,7 +199,6 @@ public class LoginListener implements PacketLoginInListener {
     }
 
     public String d() {
-        return this.i != null ? this.i + " (" + this.networkManager.getSocketAddress() + ")" : String.valueOf(this.networkManager.getSocketAddress());
         String socketAddress = networkManager == null ? null : (networkManager.getSocketAddress() == null ? null : networkManager.getSocketAddress());
         return this.i != null ? this.i + " (" + socketAddress + ")" : socketAddress;
     }
